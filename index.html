<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMB Test - Bulk Density Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            900: '#00685E',
                            700: '#8BAA99',
                            800: '#101820'
                        },
                        secondary: {
                            yellow: '#F2C75C',
                            orange: '#E59256',
                            red: '#A13525',
                            blue: '#006797',
                            teal: '#00A399',
                            brown: '#B98346'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @media print {
            .no-print { display: none !important; }
            .print-landscape { 
                size: landscape;
                margin: 0.5in;
            }
            table { 
                page-break-inside: avoid;
                font-size: 10px;
            }
            @page {
                size: A4 landscape;
                margin: 0.5in;
            }
        }
        
        .rtl { direction: rtl; }
        .ltr { direction: ltr; }
        
        /* Dark mode support */
        .dark .bg-white { background-color: #1f2937; }
        .dark .text-gray-900 { color: #f9fafb; }
        .dark .text-gray-700 { color: #d1d5db; }
        .dark .text-gray-600 { color: #9ca3af; }
        .dark .border-gray-300 { border-color: #4b5563; }
        .dark .bg-gray-50 { background-color: #111827; }
        
        /* Enhanced styling */
        .gradient-header {
            background: linear-gradient(135deg, #00685E 0%, #8BAA99 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-effect {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00685E 0%, #00A399 100%);
            transform: translateY(0);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 104, 94, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 104, 94, 0.4);
        }
        
        .btn-secondary {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .input-enhanced {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .input-enhanced:focus {
            border-color: #00685E;
            box-shadow: 0 0 0 3px rgba(0, 104, 94, 0.1);
            transform: translateY(-1px);
        }
        
        .card-enhanced {
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 104, 94, 0.1);
        }
        
        .card-enhanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 104, 94, 0.1);
        }
        
        .table-enhanced {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 104, 94, 0.1);
        }
        
        .number-cell { 
            color: #00A399; 
            font-weight: 600;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        .dark .number-cell { color: #22c55e; }
        
        .status-passed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }
        
        .status-failed {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }
        
        .icon-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .floating-action {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .premium-shadow {
            box-shadow: 0 20px 40px rgba(0, 104, 94, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <div class="gradient-header text-white p-8 rounded-2xl premium-shadow mb-8">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold mb-2" id="mainTitle">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠØ© Ù„Ù„Ø¥Ø³ÙÙ„Øª</h1>
                    <p class="text-gray-200 mt-2 text-lg" id="subtitle">GMB Test - Bulk Density Calculator</p>
                </div>
                <button onclick="toggleLanguage()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold icon-btn">
                    ğŸŒ <span id="langBtn">English</span>
                </button>
            </div>
        </div>

        <!-- Project Information -->
        <div class="glass-effect card-enhanced p-8 rounded-2xl premium-shadow mb-8">
            <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-6 flex items-center gap-3" id="projectInfoTitle">
                ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div>
                    <label for="projectName" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="projectNameLabel">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <input type="text" id="projectName" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="contractorName" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="contractorNameLabel">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</label>
                    <input type="text" id="contractorName" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="layerType" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="layerTypeLabel">Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø©</label>
                    <select id="layerType" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø©</option>
                        <option value="B.W.C">B.W.C</option>
                        <option value="B.B.C">B.B.C</option>
                    </select>
                </div>
                <div>
                    <label for="testDate" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="testDateLabel">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                    <input type="date" id="testDate" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <div>
                    <label for="minCompaction" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="minCompactionLabel">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù…Ùƒ (%)</label>
                    <input type="number" id="minCompaction" step="0.1" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="maxCompaction" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="maxCompactionLabel">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù…Ùƒ (%)</label>
                    <input type="number" id="maxCompaction" step="0.1" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
            </div>
        </div>

        <!-- Sample Input -->
        <div class="glass-effect card-enhanced p-8 rounded-2xl premium-shadow mb-8">
            <h2 class="text-2xl font-bold text-primary-900 dark:text-white mb-6 flex items-center gap-3" id="sampleInputTitle">
                ğŸ§ª Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠÙ†Ø©
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6">
                <div>
                    <label for="sampleName" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="sampleNameLabel">Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</label>
                    <input type="text" id="sampleName" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="weightInAir" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="weightInAirLabel">Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ (g)</label>
                    <input type="number" id="weightInAir" step="0.01" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="weightInWater" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="weightInWaterLabel">Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ù…Ø§Ø¡ (g)</label>
                    <input type="number" id="weightInWater" step="0.01" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="saturatedWeight" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="saturatedWeightLabel">Ø§Ù„ÙˆØ²Ù† Ù…Ø´Ø¨Ø¹ Ø§Ù„Ø³Ø·Ø­ (g)</label>
                    <input type="number" id="saturatedWeight" step="0.01" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="gmmValue" class="block text-sm font-semibold text-primary-900 dark:text-gray-300 mb-3" id="gmmValueLabel">Ù‚ÙŠÙ…Ø© GMM</label>
                    <input type="number" id="gmmValue" step="0.001" class="input-enhanced w-full px-4 py-3 text-base rounded-xl focus:ring-2 focus:ring-primary-900 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div class="flex items-end">
                    <button onclick="addSample()" class="btn-primary w-full text-white px-6 py-3 rounded-xl font-semibold icon-btn" id="addSampleBtn">
                        âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹ÙŠÙ†Ø©
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Table -->
        <div class="glass-effect card-enhanced p-8 rounded-2xl premium-shadow mb-8" id="resultsSection" style="display: none;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-primary-900 dark:text-white flex items-center gap-3" id="resultsTitle">
                    ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                </h2>
                <div class="flex gap-3 no-print flex-wrap">
                    <button onclick="clearAll()" class="btn-secondary bg-secondary-red hover:bg-red-600 text-white px-4 py-2 rounded-xl transition-colors icon-btn">
                        ğŸ—‘ï¸ <span id="clearBtn">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</span>
                    </button>
                    <button onclick="printResults()" class="btn-secondary bg-secondary-blue hover:bg-blue-600 text-white px-4 py-2 rounded-xl transition-colors icon-btn">
                        ğŸ–¨ï¸ <span id="printBtn">Ø·Ø¨Ø§Ø¹Ø©</span>
                    </button>
                    <button onclick="exportToExcel()" class="btn-secondary bg-secondary-teal hover:bg-teal-600 text-white px-4 py-2 rounded-xl transition-colors icon-btn">
                        ğŸ“‹ <span id="excelBtn">ØªØµØ¯ÙŠØ± Excel</span>
                    </button>
                    <button onclick="exportToPDF()" class="btn-secondary bg-secondary-orange hover:bg-orange-600 text-white px-4 py-2 rounded-xl transition-colors icon-btn">
                        ğŸ“„ <span id="pdfBtn">ØªØµØ¯ÙŠØ± PDF</span>
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto table-enhanced">
                <table class="w-full border-collapse text-sm" id="resultsTable">
                    <thead>
                        <tr class="gradient-header text-white">
                            <th class="px-4 py-3 font-semibold" id="thSampleName">Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</th>
                            <th class="px-4 py-3 font-semibold" id="thWeightInAir">Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ (g)</th>
                            <th class="px-4 py-3 font-semibold" id="thWeightInWater">Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ù…Ø§Ø¡ (g)</th>
                            <th class="px-4 py-3 font-semibold" id="thSaturatedWeight">Ø§Ù„ÙˆØ²Ù† Ù…Ø´Ø¨Ø¹ Ø§Ù„Ø³Ø·Ø­ (g)</th>
                            <th class="px-4 py-3 font-semibold" id="thVolume">Ø§Ù„Ø­Ø¬Ù… (cmÂ³)</th>
                            <th class="px-4 py-3 font-semibold" id="thDensity">Ø§Ù„ÙƒØ«Ø§ÙØ© (g/cmÂ³)</th>
                            <th class="px-4 py-3 font-semibold" id="thGmm">GMM</th>
                            <th class="px-4 py-3 font-semibold" id="thCompaction">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù…Ùƒ (%)</th>
                            <th class="px-4 py-3 font-semibold" id="thStatus">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="px-4 py-3 font-semibold no-print" id="thActions">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let currentLanguage = 'ar';
        let samples = [];
        
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Language translations
        const translations = {
            ar: {
                mainTitle: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒØ«Ø§ÙØ© Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠØ© Ù„Ù„Ø¥Ø³ÙÙ„Øª',
                subtitle: 'GMB Test - Bulk Density Calculator',
                langBtn: 'English',
                projectInfoTitle: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
                projectNameLabel: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
                contractorNameLabel: 'Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„',
                layerTypeLabel: 'Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø©',
                testDateLabel: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',
                minCompactionLabel: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù…Ùƒ (%)',
                maxCompactionLabel: 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù…Ùƒ (%)',
                sampleInputTitle: 'Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠÙ†Ø©',
                sampleNameLabel: 'Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©',
                weightInAirLabel: 'Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ (g)',
                weightInWaterLabel: 'Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ù…Ø§Ø¡ (g)',
                saturatedWeightLabel: 'Ø§Ù„ÙˆØ²Ù† Ù…Ø´Ø¨Ø¹ Ø§Ù„Ø³Ø·Ø­ (g)',
                gmmValueLabel: 'Ù‚ÙŠÙ…Ø© GMM',
                addSampleBtn: 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹ÙŠÙ†Ø©',
                resultsTitle: 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬',
                clearBtn: 'Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„',
                printBtn: 'Ø·Ø¨Ø§Ø¹Ø©',
                excelBtn: 'ØªØµØ¯ÙŠØ± Excel',
                pdfBtn: 'ØªØµØ¯ÙŠØ± PDF',
                thSampleName: 'Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©',
                thWeightInAir: 'Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ (g)',
                thWeightInWater: 'Ø§Ù„ÙˆØ²Ù† ÙÙŠ Ø§Ù„Ù…Ø§Ø¡ (g)',
                thSaturatedWeight: 'Ø§Ù„ÙˆØ²Ù† Ù…Ø´Ø¨Ø¹ Ø§Ù„Ø³Ø·Ø­ (g)',
                thVolume: 'Ø§Ù„Ø­Ø¬Ù… (cmÂ³)',
                thDensity: 'Ø§Ù„ÙƒØ«Ø§ÙØ© (g/cmÂ³)',
                thGmm: 'GMM',
                thCompaction: 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù…Ùƒ (%)',
                thStatus: 'Ø§Ù„Ø­Ø§Ù„Ø©',
                thActions: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª',
                passed: 'Ù…Ù‚Ø¨ÙˆÙ„',
                failed: 'Ù…Ø±ÙÙˆØ¶',
                delete: 'Ø­Ø°Ù',
                selectLayer: 'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ù‚Ø©'
            },
            en: {
                mainTitle: 'Asphalt Bulk Density Test',
                subtitle: 'GMB Test - Bulk Density Calculator',
                langBtn: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
                projectInfoTitle: 'Project Information',
                projectNameLabel: 'Project Name',
                contractorNameLabel: 'Contractor Name',
                layerTypeLabel: 'Layer Type',
                testDateLabel: 'Test Date',
                minCompactionLabel: 'Minimum Compaction (%)',
                maxCompactionLabel: 'Maximum Compaction (%)',
                sampleInputTitle: 'Sample Data Input',
                sampleNameLabel: 'Sample Name',
                weightInAirLabel: 'Weight in Air (g)',
                weightInWaterLabel: 'Weight in Water (g)',
                saturatedWeightLabel: 'Saturated Surface Weight (g)',
                gmmValueLabel: 'GMM Value',
                addSampleBtn: 'Add Sample',
                resultsTitle: 'Results',
                clearBtn: 'Clear All',
                printBtn: 'Print',
                excelBtn: 'Export Excel',
                pdfBtn: 'Export PDF',
                thSampleName: 'Sample Name',
                thWeightInAir: 'Weight in Air (g)',
                thWeightInWater: 'Weight in Water (g)',
                thSaturatedWeight: 'Saturated Surface Weight (g)',
                thVolume: 'Volume (cmÂ³)',
                thDensity: 'Density (g/cmÂ³)',
                thGmm: 'GMM',
                thCompaction: 'Compaction (%)',
                thStatus: 'Status',
                thActions: 'Actions',
                passed: 'Passed',
                failed: 'Failed',
                delete: 'Delete',
                selectLayer: 'Select Layer Type'
            }
        };

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            updateLanguage();
        }

        function updateLanguage() {
            const isArabic = currentLanguage === 'ar';
            document.documentElement.setAttribute('lang', currentLanguage);
            document.documentElement.setAttribute('dir', isArabic ? 'rtl' : 'ltr');
            
            // Update all text elements
            Object.keys(translations[currentLanguage]).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = translations[currentLanguage][key];
                }
            });

            // Update select options
            const layerSelect = document.getElementById('layerType');
            layerSelect.innerHTML = `
                <option value="">${translations[currentLanguage].selectLayer}</option>
                <option value="B.W.C">B.W.C</option>
                <option value="B.B.C">B.B.C</option>
            `;

            // Update table if exists
            updateTable();
        }

        function addSample() {
            const sampleName = document.getElementById('sampleName').value.trim();
            const weightInAir = parseFloat(document.getElementById('weightInAir').value);
            const weightInWater = parseFloat(document.getElementById('weightInWater').value);
            const saturatedWeight = parseFloat(document.getElementById('saturatedWeight').value);
            const gmmValue = parseFloat(document.getElementById('gmmValue').value);

            // Validation
            if (!sampleName) {
                showCustomAlert(currentLanguage === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©' : 'Please enter sample name');
                return;
            }

            if (isNaN(weightInAir) || isNaN(weightInWater) || isNaN(saturatedWeight) || isNaN(gmmValue)) {
                showCustomAlert(currentLanguage === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©' : 'Please enter all required values');
                return;
            }

            if (samples.length >= 50) {
                showCustomAlert(currentLanguage === 'ar' ? 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† 50 Ø¹ÙŠÙ†Ø©' : 'Cannot add more than 50 samples');
                return;
            }

            // Calculations
            const volume = saturatedWeight - weightInWater;
            const density = weightInAir / volume;
            const compactionPercentage = (density / gmmValue) * 100;

            const sample = {
                id: Date.now(),
                name: sampleName,
                weightInAir,
                weightInWater,
                saturatedWeight,
                volume: volume.toFixed(2),
                density: density.toFixed(3),
                gmm: gmmValue,
                compaction: compactionPercentage.toFixed(2)
            };

            samples.push(sample);
            updateTable();
            clearInputs();
            
            document.getElementById('resultsSection').style.display = 'block';
        }

        function updateTable() {
            const tbody = document.getElementById('tableBody');
            const minCompaction = parseFloat(document.getElementById('minCompaction').value) || 0;
            const maxCompaction = parseFloat(document.getElementById('maxCompaction').value) || 100;

            tbody.innerHTML = samples.map(sample => {
                const compaction = parseFloat(sample.compaction);
                const status = (compaction >= minCompaction && compaction <= maxCompaction) 
                    ? translations[currentLanguage].passed 
                    : translations[currentLanguage].failed;
                const statusClass = (compaction >= minCompaction && compaction <= maxCompaction) 
                    ? 'text-green-600' 
                    : 'text-red-600';

                const statusBadge = (compaction >= minCompaction && compaction <= maxCompaction) 
                    ? `<span class="status-passed">âœ… ${status}</span>`
                    : `<span class="status-failed">âŒ ${status}</span>`;

                return `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700">
                        <td class="px-4 py-3 font-medium text-gray-900 dark:text-white">${sample.name}</td>
                        <td class="px-4 py-3 number-cell">${sample.weightInAir}</td>
                        <td class="px-4 py-3 number-cell">${sample.weightInWater}</td>
                        <td class="px-4 py-3 number-cell">${sample.saturatedWeight}</td>
                        <td class="px-4 py-3 number-cell">${sample.volume}</td>
                        <td class="px-4 py-3 number-cell">${sample.density}</td>
                        <td class="px-4 py-3 number-cell">${sample.gmm}</td>
                        <td class="px-4 py-3 number-cell">${sample.compaction}</td>
                        <td class="px-4 py-3 text-center">${statusBadge}</td>
                        <td class="px-4 py-3 no-print">
                            <button onclick="deleteSample(${sample.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-xs transition-colors">
                                ğŸ—‘ï¸ ${translations[currentLanguage].delete}
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function deleteSample(id) {
            samples = samples.filter(sample => sample.id !== id);
            updateTable();
            if (samples.length === 0) {
                document.getElementById('resultsSection').style.display = 'none';
            }
        }

        function clearInputs() {
            document.getElementById('sampleName').value = '';
            document.getElementById('weightInAir').value = '';
            document.getElementById('weightInWater').value = '';
            document.getElementById('saturatedWeight').value = '';
            document.getElementById('gmmValue').value = '';
        }

        function clearAll() {
            showConfirmDialog(
                currentLanguage === 'ar' ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹ÙŠÙ†Ø§ØªØŸ' : 'Are you sure you want to delete all samples?',
                () => {
                    samples = [];
                    updateTable();
                    document.getElementById('resultsSection').style.display = 'none';
                }
            );
        }

        function printResults() {
            window.print();
        }

        function exportToExcel() {
            if (samples.length === 0) {
                showCustomAlert(currentLanguage === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙŠÙ†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±' : 'No samples to export');
                return;
            }

            const projectInfo = {
                projectName: document.getElementById('projectName').value || 'N/A',
                contractorName: document.getElementById('contractorName').value || 'N/A',
                layerType: document.getElementById('layerType').value || 'N/A',
                testDate: document.getElementById('testDate').value || 'N/A',
                minCompaction: document.getElementById('minCompaction').value || 'N/A',
                maxCompaction: document.getElementById('maxCompaction').value || 'N/A'
            };

            const minCompaction = parseFloat(document.getElementById('minCompaction').value) || 0;
            const maxCompaction = parseFloat(document.getElementById('maxCompaction').value) || 100;

            const data = [
                ['GMB Test Results'],
                [''],
                ['Project Information:'],
                ['Project Name:', projectInfo.projectName],
                ['Contractor Name:', projectInfo.contractorName],
                ['Layer Type:', projectInfo.layerType],
                ['Test Date:', projectInfo.testDate],
                ['Min Compaction (%):', projectInfo.minCompaction],
                ['Max Compaction (%):', projectInfo.maxCompaction],
                [''],
                ['Sample Results:'],
                ['Sample Name', 'Weight in Air (g)', 'Weight in Water (g)', 'Saturated Surface Weight (g)', 'Volume (cmÂ³)', 'Density (g/cmÂ³)', 'GMM', 'Compaction (%)', 'Status'],
                ...samples.map(sample => {
                    const compaction = parseFloat(sample.compaction);
                    const status = (compaction >= minCompaction && compaction <= maxCompaction) ? 'Passed' : 'Failed';
                    return [
                        sample.name,
                        sample.weightInAir,
                        sample.weightInWater,
                        sample.saturatedWeight,
                        sample.volume,
                        sample.density,
                        sample.gmm,
                        sample.compaction,
                        status
                    ];
                })
            ];

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'GMB Test Results');
            XLSX.writeFile(wb, 'GMB_Test_Results.xlsx');
        }

        function exportToPDF() {
            if (samples.length === 0) {
                showCustomAlert(currentLanguage === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙŠÙ†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±' : 'No samples to export');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape', 'mm', 'a4');

            const projectInfo = {
                projectName: document.getElementById('projectName').value || 'N/A',
                contractorName: document.getElementById('contractorName').value || 'N/A',
                layerType: document.getElementById('layerType').value || 'N/A',
                testDate: document.getElementById('testDate').value || 'N/A',
                minCompaction: document.getElementById('minCompaction').value || 'N/A',
                maxCompaction: document.getElementById('maxCompaction').value || 'N/A'
            };

            const minCompaction = parseFloat(document.getElementById('minCompaction').value) || 0;
            const maxCompaction = parseFloat(document.getElementById('maxCompaction').value) || 100;

            // Header background
            doc.setFillColor(0, 104, 94); // Primary color #00685E
            doc.rect(15, 10, 267, 25, 'F');
            
            // Title
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont(undefined, 'bold');
            doc.text('ğŸ—ï¸ GMB Test - Bulk Density Results', 148, 25, { align: 'center' });

            // Project Information Section
            let yPos = 45;
            
            // Section background
            doc.setFillColor(139, 170, 153); // Secondary color #8BAA99
            doc.rect(15, yPos - 5, 267, 35, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('ğŸ“‹ Project Information', 20, yPos + 5);

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            yPos += 12;
            doc.text(`ğŸ“Œ Project Name: ${projectInfo.projectName}`, 20, yPos);
            doc.text(`ğŸ‘· Contractor Name: ${projectInfo.contractorName}`, 150, yPos);
            yPos += 8;
            doc.text(`ğŸ”§ Layer Type: ${projectInfo.layerType}`, 20, yPos);
            doc.text(`ğŸ“… Test Date: ${projectInfo.testDate}`, 150, yPos);
            yPos += 8;
            doc.text(`ğŸ“Š Compaction Range: ${projectInfo.minCompaction}% - ${projectInfo.maxCompaction}%`, 20, yPos);

            // Table section
            yPos += 20;
            
            // Table headers
            doc.setFontSize(10);
            const headers = ['Sample', 'Air (g)', 'Water (g)', 'Saturated (g)', 'Volume (cmÂ³)', 'Density (g/cmÂ³)', 'GMM', 'Compaction (%)', 'Status'];
            let xPos = 20;
            const colWidths = [25, 20, 20, 25, 25, 25, 20, 25, 20];

            // Header row background
            doc.setFillColor(0, 104, 94); // Primary color
            doc.rect(xPos, yPos - 5, colWidths.reduce((a, b) => a + b, 0), 8, 'F');
            
            // Header text
            doc.setTextColor(255, 255, 255);
            doc.setFont(undefined, 'bold');
            headers.forEach((header, index) => {
                doc.text(header, xPos + 2, yPos);
                xPos += colWidths[index];
            });

            // Data rows
            yPos += 8;
            let rowIndex = 0;
            samples.forEach(sample => {
                const compaction = parseFloat(sample.compaction);
                const status = (compaction >= minCompaction && compaction <= maxCompaction) ? 'âœ… Passed' : 'âŒ Failed';
                const isPassed = compaction >= minCompaction && compaction <= maxCompaction;
                
                xPos = 20;
                
                // Alternating row colors
                if (rowIndex % 2 === 0) {
                    doc.setFillColor(248, 250, 252); // Light gray
                } else {
                    doc.setFillColor(241, 245, 249); // Darker gray
                }
                doc.rect(xPos, yPos - 5, colWidths.reduce((a, b) => a + b, 0), 8, 'F');
                
                const rowData = [
                    sample.name,
                    sample.weightInAir.toString(),
                    sample.weightInWater.toString(),
                    sample.saturatedWeight.toString(),
                    sample.volume,
                    sample.density,
                    sample.gmm.toString(),
                    sample.compaction,
                    status
                ];

                rowData.forEach((data, index) => {
                    if (index === 0) {
                        // Sample name in dark text
                        doc.setTextColor(16, 24, 32); // #101820
                        doc.setFont(undefined, 'bold');
                    } else if (index >= 1 && index <= 7) {
                        // Numbers in green
                        doc.setTextColor(0, 163, 153); // #00A399
                        doc.setFont(undefined, 'normal');
                    } else {
                        // Status
                        if (isPassed) {
                            doc.setTextColor(16, 185, 129); // Green
                        } else {
                            doc.setTextColor(239, 68, 68); // Red
                        }
                        doc.setFont(undefined, 'bold');
                    }
                    
                    doc.text(data.substring(0, 12), xPos + 2, yPos);
                    xPos += colWidths[index];
                });
                
                yPos += 8;
                rowIndex++;

                // Check if we need a new page
                if (yPos > 180) {
                    doc.addPage();
                    yPos = 20;
                    rowIndex = 0; // Reset row index for new page
                }
            });

            // Footer
            const pageHeight = doc.internal.pageSize.height;
            doc.setFillColor(0, 104, 94);
            doc.rect(15, pageHeight - 20, 267, 15, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Generated on: ${new Date().toLocaleDateString()} | Total Samples: ${samples.length}`, 20, pageHeight - 10);

            doc.save('GMB_Test_Results_Colored.pdf');
        }

        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary-900 text-white hover:bg-primary-700 rounded" onclick="this.closest('.fixed').remove()">
                            ${currentLanguage === 'ar' ? 'Ù…ÙˆØ§ÙÙ‚' : 'OK'}
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" onclick="this.closest('.fixed').remove()">
                            ${currentLanguage === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel'}
                        </button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded" onclick="this.closest('.fixed').remove(); onConfirm()">
                            ${currentLanguage === 'ar' ? 'ØªØ£ÙƒÙŠØ¯' : 'Confirm'}
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Set current date as default
        document.getElementById('testDate').valueAsDate = new Date();
        
        // Initialize language
        updateLanguage();
    </script>
</body>
</html>
